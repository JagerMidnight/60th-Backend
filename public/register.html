<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Event Registration Form</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background-color: #2c3e50;
            color: #ecf0f1;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            flex-direction: column;
        }

        .container {
            background-color: #34495e;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            padding: 40px;
            width: 100%;
            max-width: 600px;
        }

        h1 {
            text-align: center;
            color: #ecf0f1;
            margin-bottom: 20px;
        }

        label {
            display: block;
            font-size: 16px;
            margin-bottom: 8px;
            color: #ecf0f1;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px;
            font-size: 16px;
            border: 1px solid #7f8c8d;
            border-radius: 8px;
            margin-bottom: 20px;
            background-color: #34495e;
            color: #ecf0f1;
        }

        button {
            width: 100%;
            padding: 14px;
            background-color: #3498db;
            color: white;
            font-size: 18px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }

        button:hover {
            background-color: #2980b9;
        }

        #resultMessage {
            text-align: center;
            margin-top: 20px;
            padding: 10px;
            color: white;
            display: none;
            border-radius: 8px;
        }

        .success {
            background-color: #2ecc71;
        }

        .error {
            background-color: #e74c3c;
        }

        /* Event Details Box */
        #eventDetailsBox {
            background-color: #34495e;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 10px;
        }

        /* Title Style */
        #eventDetailsTitle {
            text-align: center;
            color: #ecf0f1;
            font-size: 24px;
            margin-bottom: 10px;
        }

        /* Display Camp Name */
        #campNameDisplay {
            text-align: center;
            color: #ecf0f1;
            font-size: 18px;
            margin-bottom: 10px;
        }

        /* Event Details content */
        #eventDetailsContent {
            display: none;
            text-align: center;
        }

        #eventDetailsContent p {
            font-size: 16px;
            color: #bdc3c7;
        }

        /* Event details not available */
        #eventDetailsNotAvailable {
            text-align: center;
            color: #e74c3c;
            font-size: 18px;
            font-weight: bold;
        }
    </style>
</head>
<body>

    <!-- Event Details Box -->
    <div id="eventDetailsBox">
        <div id="eventDetailsTitle">Event Details</div>
        <!-- Placeholder for Event details -->
        <div id="eventDetailsContent">
            <p><strong>Name:</strong> <span id="eventName"></span></p>
            <p><strong>Location:</strong> <span id="eventLocation"></span></p>
            <p><strong>Date:</strong> <span id="eventDate"></span></p>
            <p><strong>Time:</strong> <span id="eventTime"></span></p>
            <p><strong>Host:</strong> <span id="eventHost"></span></p>
        </div>
        <!-- Display message when details are unavailable -->
        <div id="eventDetailsNotAvailable" style="display: none;">EVENT DETAILS NOT AVAILABLE</div>
    </div>

    <div class="container">
        <h1>Event Registration</h1>

        <!-- Youth Info -->
        <label for="youthName">Youth's Name</label>
        <input type="text" id="youthName" placeholder="Enter youth's name" required>

        <label for="phone">Phone</label>
        <input type="text" id="phone" placeholder="Enter phone number" required>

        <label for="address">Address</label>
        <input type="text" id="address" placeholder="Enter address" required>

        <label for="city">City</label>
        <input type="text" id="city" placeholder="Enter city" required>

        <label for="province">Province</label>
        <input type="text" id="province" placeholder="Enter province" required>

        <label for="postalCode">Postal Code</label>
        <input type="text" id="postalCode" placeholder="Enter postal code" required>

        <!-- Parent/Guardian Info -->
        <div id="parentGuardianSection" style="display: none;">
            <label for="parentName">Parent/Guardian Name</label>
            <input type="text" id="parentName" placeholder="Enter parent/guardian's name" required>
        </div>

        <label for="permission">Permission to Participate</label>
        <textarea id="permission" placeholder="Enter your permission here..." required></textarea>

        <!-- Emergency Contact -->
        <label for="emergencyContact">Emergency Contact</label>
        <input type="text" id="emergencyContact" placeholder="Enter emergency contact name" required>

        <label for="emergencyPhone">Emergency Contact Phone</label>
        <input type="text" id="emergencyPhone" placeholder="Enter emergency contact phone" required>

        <!-- Submit Button -->
        <button type="submit" onclick="submitForm()">Submit</button>

        <!-- Result message container -->
        <p id="resultMessage"></p>
    </div>

    <script>
        // Function to parse the URL query parameters
        function getQueryParam(name) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(name);
        }

        // Function to display the Camp Name from the URL
        function displayEventDetails() {
            const eventName = getQueryParam('name');
            const eventLocation = getQueryParam('location');
            const eventDate = getQueryParam('date');
            const eventTime = getQueryParam('time');
            const eventHost = getQueryParam('host');

            // Check if any event details are missing
            if (!eventName && !eventLocation && !eventDate && !eventTime && !eventHost) {
                // If all details are missing, show "EVENT DETAILS NOT AVAILABLE"
                document.getElementById('eventDetailsNotAvailable').style.display = 'block';
                document.getElementById('eventDetailsContent').style.display = 'none';
            } else {
                // If any detail is available, show the event details
                document.getElementById('eventDetailsNotAvailable').style.display = 'none';
                document.getElementById('eventDetailsContent').style.display = 'block';

                document.getElementById('eventName').innerText = eventName || 'N/A';
                document.getElementById('eventLocation').innerText = eventLocation || 'N/A';
                document.getElementById('eventDate').innerText = eventDate || 'N/A';
                document.getElementById('eventTime').innerText = eventTime || 'N/A';
                document.getElementById('eventHost').innerText = eventHost || 'N/A';
            }
        }

        // Call the function on page load
        window.onload = function () {
            displayEventDetails();
        };

        // Submit form function
        function submitForm() {
            const resultMessage = document.getElementById('resultMessage');
            resultMessage.style.display = 'none'; // Hide previous result message

            const youthName = document.getElementById('youthName').value.trim();
            const phone = document.getElementById('phone').value.trim();
            const address = document.getElementById('address').value.trim();
            const city = document.getElementById('city').value.trim();
            const province = document.getElementById('province').value.trim();
            const postalCode = document.getElementById('postalCode').value.trim();
            const emergencyContact = document.getElementById('emergencyContact').value.trim();
            const emergencyPhone = document.getElementById('emergencyPhone').value.trim();
            const permission = document.getElementById('permission').value.trim();
            let parentName = document.getElementById('parentName') ? document.getElementById('parentName').value.trim() : '';

            if (!youthName || !phone || !address || !city || !province || !postalCode || !emergencyContact || !emergencyPhone || !permission || (parentName === "" && getQueryParam('under18') === 'true')) {
                resultMessage.innerText = 'Please fill out all required fields.';
                resultMessage.className = 'error'; // Show error message
                resultMessage.style.display = 'block';
                return;
            }

            // Get email address from environment variable
            const emailUri = process.env.EMAIL_URI;

            // Mailto link for form submission
            const mailtoLink = `mailto:${emailUri}?subject=${getQueryParam('name')} Registration&body=Camp Name: ${getQueryParam('name')}%0AYouth's Name: ${youthName}%0APhone: ${phone}%0AAddress: ${address}%0ACity: ${city}%0AProvince: ${province}%0APostal Code: ${postalCode}%0AEmergency Contact: ${emergencyContact}%0AEmergency Phone: ${emergencyPhone}%0APermission: ${permission}${parentName ? '%0AParent/Guardian Name: ' + parentName : ''}`;

            // Open the email client with pre-filled info
            window.location.href = mailtoLink;

            // Show success message
            resultMessage.innerText = 'Form submitted successfully!';
            resultMessage.className = 'success'; // Show success message
            resultMessage.style.display = 'block';
        }
    </script>
</body>
</html>
